<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width,initial-scale=1.0" />
<title>Heart Balloon · Ultra Smooth Motion</title>
<style>
html,body{
  margin:0;
  height:100%;
  width:100%;
  background:#fff;
  overflow:hidden;
  touch-action:none;
}
canvas{
  position:fixed;
  top:0;left:0;
  width:100%;height:100%;
  pointer-events:none;
}
svg{
  position:absolute;
  width:160px;height:420px;
  filter:drop-shadow(0 0 18px rgba(255,80,150,0.6));
  user-select:none;pointer-events:none;
}
button{
  position:absolute;
  padding:10px 20px;
  border:none;border-radius:8px;
  background:#ff4fa5;color:#fff;
  font-weight:bold;cursor:pointer;
  font-family:sans-serif;
}
#btn1{top:40%;left:40%;}
#btn2{top:70%;left:60%;}
</style>
</head>
<body>

<canvas id="rope"></canvas>
<button id="btn1">Add</button>
<button id="btn2">Replace</button>

<svg id="balloon" viewBox="0 0 100 400">
  <defs>
    <radialGradient id="grad" cx="35%" cy="25%" r="65%">
      <stop offset="0%" stop-color="#ffb7df"/>
      <stop offset="40%" stop-color="#ff4fa5"/>
      <stop offset="100%" stop-color="#ff007b"/>
    </radialGradient>
  </defs>
  <path fill="url(#grad)" d="
    M50 20
    C35 0, 5 10, 5 40
    C5 70, 40 100, 50 130
    C60 100, 95 70, 95 40
    C95 10, 65 0, 50 20
    Q50 132, 50 134
  "/>
</svg>

<script>
const balloon=document.getElementById("balloon");
const canvas=document.getElementById("rope");
const ctx=canvas.getContext("2d");
const buttons=[...document.querySelectorAll("button")];
let W,H;
function resize(){W=canvas.width=innerWidth;H=canvas.height=innerHeight;}
resize();addEventListener("resize",resize);

let bx=Math.random()*(innerWidth-200)+100;
let by=Math.random()*(innerHeight*0.5)+100;
balloon.style.left=bx-80+"px";
balloon.style.top=by+"px";

// rope nodes
const N=30, seg=18;
const nodes=Array.from({length:N},(_,i)=>({x:bx,y:by+i*seg,vx:0,vy:0}));

let vx=0,vy=0;
let held=false,prevX=0,prevY=0;

function startHold(e){
  if(e.target.tagName==="BUTTON")return;
  held=true;prevX=e.clientX;prevY=e.clientY;
}
function moveHold(e){
  if(!held)return;
  const dx=e.clientX-prevX,dy=e.clientY-prevY;
  vx+=dx*0.03;vy+=dy*0.03;
  prevX=e.clientX;prevY=e.clientY;
}
function endHold(){held=false;}

document.addEventListener("mousedown",startHold);
document.addEventListener("mousemove",moveHold);
document.addEventListener("mouseup",endHold);
document.addEventListener("touchstart",e=>startHold(e.touches[0]));
document.addEventListener("touchmove",e=>moveHold(e.touches[0]));
document.addEventListener("touchend",endHold);

function repelSlide(x,y,cx,cy,radius,strength){
  const dx=x-cx,dy=y-cy;
  const dist=Math.hypot(dx,dy);
  if(dist===0||dist>radius)return{x,y,vx:0,vy:0};
  const nx=dx/dist,ny=dy/dist;
  const overlap=(radius-dist)/radius;
  const ease=overlap*overlap*(3-2*overlap);
  let px=x+nx*ease*radius*strength;
  let py=y+ny*ease*radius*strength;
  const tx=-ny,ty=nx;
  const slideMag=overlap*0.3;
  return{
    x:px+tx*slideMag,
    y:py+ty*slideMag,
    vx:tx*slideMag*0.3,
    vy:ty*slideMag*0.3
  };
}

function loop(){
  requestAnimationFrame(loop);
  ctx.clearRect(0,0,W,H);

  // smoother float
  by+=Math.sin(Date.now()/900)*0.12;
  bx+=Math.cos(Date.now()/1300)*0.09;
  vx*=0.95;vy*=0.95;
  bx+=vx;by+=vy;

  bx=Math.max(80,Math.min(innerWidth-80,bx));
  by=Math.max(80,Math.min(innerHeight-160,by));

  // button repulsion
  for(const b of buttons){
    const br=b.getBoundingClientRect();
    const cx=br.left+br.width/2,cy=br.top+br.height/2;
    const radius=Math.max(br.width,br.height)*1.6;
    const r=repelSlide(bx,by,cx,cy,radius,0.4);
    bx=r.x;by=r.y;vx+=r.vx;vy+=r.vy;
  }

  balloon.style.left=bx-80+"px";
  balloon.style.top=by+"px";

  // rope physics
  nodes[0].x=bx;
  nodes[0].y=by+140;

  for(let i=1;i<N;i++){
    const n=nodes[i],p=nodes[i-1];
    n.vy+=0.025;
    n.x+=n.vx+(p.vx*0.2);
    n.y+=n.vy+(p.vy*0.2);
    n.vx*=0.92;n.vy*=0.92;

    // avoid buttons
    for(const b of buttons){
      const br=b.getBoundingClientRect();
      const cx=br.left+br.width/2,cy=br.top+br.height/2;
      const radius=Math.max(br.width,br.height)*1.5;
      const r=repelSlide(n.x,n.y,cx,cy,radius,0.35);
      n.x=r.x;n.y=r.y;n.vx+=r.vx;n.vy+=r.vy;
    }

    // constraint — more elastic
    const dx=n.x-p.x,dy=n.y-p.y;
    const dist=Math.hypot(dx,dy)||0.001;
    const diff=(dist-seg)/dist;
    const force=Math.min(Math.max(diff,-0.25),0.25);
    n.x-=dx*force*0.6;
    n.y-=dy*force*0.6;
    p.x+=dx*force*0.4;
    p.y+=dy*force*0.4;
  }

  // subtle motion smoothing
  for(let i=1;i<N;i++){
    const prev=nodes[i-1],cur=nodes[i];
    cur.vx+=(prev.x-cur.x)*0.004;
    cur.vy+=(prev.y-cur.y)*0.004;
  }

  // draw rope
  ctx.beginPath();
  ctx.moveTo(nodes[0].x,nodes[0].y);
  for(let i=1;i<N-2;i++){
    const xc=(nodes[i].x+nodes[i+1].x)/2;
    const yc=(nodes[i].y+nodes[i+1].y)/2;
    ctx.quadraticCurveTo(nodes[i].x,nodes[i].y,xc,yc);
  }
  ctx.quadraticCurveTo(nodes[N-2].x,nodes[N-2].y,nodes[N-1].x,nodes[N-1].y);
  ctx.strokeStyle="rgba(255,47,137,0.9)";
  ctx.lineWidth=2.3;
  ctx.lineCap="round";
  ctx.shadowColor="rgba(255,47,137,0.5)";
  ctx.shadowBlur=8;
  ctx.stroke();
  ctx.shadowBlur=0;
}
loop();
</script>
</body>
</html>
